ARA Network Channels (ANC)
=========================

---
Request For Comments: 0003
Author(s): Joseph Werle
Category: Discovery
Date: June 2018
---

## 0. Abstract

_*ARA Network Channels*_, or *ANC*, are peer discovery channels using popular
decentralized peer discovery mechanisms like Domain Name Systems (DNS)
[1], Distributed Hash Tables (DHT) [2], and Multicast Domain Name
Systems (mDNS) [3].

## 1. Status

This RFC is under _active development and consideration_.

## 2. Introduction

Through peer discovery nodes in the *ARA Network* can interact with each
other without a central authority brokering their relationships. _*ARA
Network Channels*_ make use of popular peer discovery strategies to
enable this. While containing mostly configuration and workflow, this document
outlines the usage of various networking systems to discover peers within a
network.

## 3. Peer Discovery

_*ARA Network Channels*_ announce and discover peers over various
networks through a shared discovery key. This is often a unique shared
secret between two or more interested parties whom wish to peer
connections.

## 4. Domain Name System (DNS)

Through traditional *DNS over UDP*, peers can be discovered using a
shared secret, or more conventionally known as a *discovery key*. The *discovery
key* can be used in place of hostnames for an `A` record's **name** field. This
allows peers to respond with an "answer" to a query's "question" for some `A`
record when comparing **name** fields when queries occur. This creates a
*one-to-many* relationship mapping many peers to a single shared discovery key
while using core DNS. Discovery keys used in conjunction with DNS offer a
channel of discovery for peers over the Internet without changing the DNS
protocol.

### 4.1 Service Discovery (DNS-SD)

Network nodes can leverage the Simple Simple Discovery Protocol [4] to
broadcast their availablity of some service. This section outlines the
`PTR`, `SRV`, `TXT`, and `A`/`AAAA` records used by _*ARA Network
Channels*_ for peer discovery using a discovery key.

#### 4.1.1 PTR

The `PTR` record indicates available "zones", or network nodes,
broadcasting their availablity as a service. The `_ara._tcp.local` and
`_ara._udp.local` `PTR` records resolve zones of network nodes
broadcasting services as `SRV` records.

##### Query

Service discovery for network nodes starts with a query containing a
_question_ _type_ set to `PTR` and the _name_ set to `_ara._tcp.local`
and another set to `_ara._udp.local`.

```
{ "class": "IN", "type": PTR"," "name" : "_ara._tcp.local" }
{ "class": "IN", "type": PTR"," "name" : "_ara._udp.local" }
```

##### Response

Network nodes broadcasting their availability respond to this query by
providing `SRV` and `TXT` answers.

#### 4.1.2 SRV & TXT

Network nodes responding to the `PTR` query answer with a `PTR` record with a
_data_ attribute pointing to a `SRV` and `TXT` record that has a hostname target.

A record may look like:

```
{ "class": "IN", "type": "PTR", "name": "_ara._tcp.local", "data": "<DKEY>._ara._tcp.local" }
{ "class": "IN", "type": "PTR", "name": "_ara._udp.local", "data": "<DKEY>._ara._udp.local" }
```

where `<DKEY>` is a discovery key for the network node or a service
offered by a network node. Discovery keys are 32 byte `BLAKE2b` (64
characters) hashes derived as output from a keystore in a
_ARA Network Secrets_ [5] blob and often look like:

```
6c67e61f60cc8692acbccf27ede4547afe8d9fa282ff5269c89a865e4bc3bb92._ara._tcp.local
```

These `PTR` targets resolve to `SRV` and `TXT` records used to help
determine the location (IP) of a service, the port to connect on, and
metadata about the service itself.

**SRV**

The `SRV` record should specify a port to connect to and resolve a target
`A`/`AAAA` record or IP address.

```
{ "class": "IN", "type": "SRV",
  "name": "6c67e61f60cc8692acbccf27ede4547afe8d9fa282ff5269c89a865e4bc3bb92._ara._tcp.local",
  "data": { "port": 3280, "target": "d7da75db715e9ec489582517601f380b201872bb0a281a5c6b04bca3ddca5cad.local" } }
```

**TXT**

The `TXT` record may contain public metadata, configuration, or other
ancillary information related to the service being broadcasted.

#### 4.1.3 A/AAAA

`A`/`AAAA` records pointed to by a `SRV` target should resolve to IP
addresses that a network node broadcasts on for a service. The _name_
field for a record should be a `SHA256` hash of the _data_ field (IPv4
or IPv6 address) with the `.local` top-level domain [6].

An IPv4 `A` record for the network address `192.168.1.101` might look
like this:

```
{ "class": "IN", "type": "A",
  "name": "d7da75db715e9ec489582517601f380b201872bb0a281a5c6b04bca3ddca5cad.local",
  "data": "192.168.1.101" }
```

### 4.2 Universal Plug and Play (UPnP)

TODO

## 5. Multicast Domain Name System (mDNS)

Multicast DNS helps enable peer discovery over a local network without the
need for a local DNS (4) server. Peers announce themselves on a domain and
can discover others announcing on the same domain. *mDNS* operates like
traditional DNS over local networks allowing resolution of DNS records.
*mDNS* and *DNS* working together enable broader peer discovery by
combining both local and external networks.

### 5.1 Domain

_*ARA Network Channels*_ broadcast on `<DKEY>.ara.local` by default where
`<DKEY>` is the discovery key for a network node. Networks nodes can be
configured to loopback making themselves discoverable on the same machine's
network interfaces. This domain differs from the `._ara.` variant used above
in section 4.1 about _Service Discovery_ as it ignores the protocol type postfix
and the usage of an underscore `_` prefix in the domain name. These channels
are typically available for server-to-server interactions.

Network nodes respond to questions about `SRV` and `A` records 
*Example mDNS domain with discovery key subdomain:*

```
6c67e61f60cc8692acbccf27ede4547afe8d9fa282ff5269c89a865e4bc3bb92.ara.local
```



### 5.2 Service Discovery (mDNS-SD)

Service discovery of Multicast DNS is possible the same way DNS-SD
works (4.1) where instead of a DNS queries going to a DNS serverr (or
cache), they are sent to a Multicast group in a local network.

### 5.3 Universal Plug and Play (UPnP)

TODO

## 6. Distributed Hash Table (DHT)

Distributed Hash Tables enable peer discovery through a lookup query
where an `info_hash`, or discovery key, for a `get_peers` DHT query []
links peers in various networks together to form a channel.
_*ARA Networks Channels*_ can make use of a Bittorrent DHT implementation
to track peers who share network discovery keys.

## Considerations

TODO

## References

* [1]: *DNS* - https://en.wikipedia.org/wiki/Domain_Name_System
* [2]: *DHT* - https://en.wikipedia.org/wiki/Distributed_hash_table
* [3]: *mDNS* - https://en.wikipedia.org/wiki/Multicast_DNS
* [4]: *SSDP* - https://en.wikipedia.org/wiki/Simple_Service_Discovery_Protocol
* [5]: *ANS* -  https://github.com/arablocks/ara-network/tree/master/rfc/rfc0001.md
* [6]: *.local* - https://en.wikipedia.org/wiki/.local
* []: *BEP 0005* - http://www.bittorrent.org/beps/bep_0005.html
